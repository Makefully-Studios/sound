{"version":3,"file":"render.mjs","sources":["../../src/utils/render.ts"],"sourcesContent":["import { CanvasSource, ICanvas, TextureSource } from 'pixi.js';\r\nimport { Sound } from '../Sound';\r\nimport { WebAudioMedia } from '../webaudio/WebAudioMedia';\r\n\r\ninterface RenderOptions\r\n{\r\n    /**\r\n     * Width of the render.\r\n     * @default 512\r\n     */\r\n    width?: number;\r\n    /**\r\n     * Height of the render.\r\n     * @default 128\r\n     */\r\n    height?: number;\r\n    /**\r\n     * Fill style for waveform.\r\n     * @default 'black'\r\n     */\r\n    fill?: string | CanvasPattern | CanvasGradient;\r\n}\r\n\r\n/**\r\n * Render image as Texture. **Only supported with WebAudio**\r\n * @memberof utils\r\n * @param sound - Instance of sound to render\r\n * @param options - Custom rendering options\r\n * @return Result texture\r\n */\r\nfunction render(sound: Sound, options?: RenderOptions): TextureSource\r\n{\r\n    const canvas: HTMLCanvasElement = document.createElement('canvas');\r\n\r\n    options = {\r\n        width: 512,\r\n        height: 128,\r\n        fill: 'black', ...(options || {})\r\n    };\r\n\r\n    canvas.width = options.width;\r\n    canvas.height = options.height;\r\n\r\n    const textureSource = new CanvasSource({\r\n        resource: canvas as ICanvas,\r\n    });\r\n\r\n    if (!(sound.media instanceof WebAudioMedia))\r\n    {\r\n        return textureSource;\r\n    }\r\n\r\n    const media: WebAudioMedia = sound.media as WebAudioMedia;\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.assert(!!media.buffer, 'No buffer found, load first');\r\n\r\n    const context: CanvasRenderingContext2D = canvas.getContext('2d');\r\n\r\n    context.fillStyle = options.fill;\r\n    const data: Float32Array = media.buffer.getChannelData(0);\r\n    const step: number = Math.ceil(data.length / options.width);\r\n    const amp: number = options.height / 2;\r\n\r\n    for (let i = 0; i < options.width; i++)\r\n    {\r\n        let min = 1.0;\r\n        let max = -1.0;\r\n\r\n        for (let j = 0; j < step; j++)\r\n        {\r\n            const datum: number = data[(i * step) + j];\r\n\r\n            if (datum < min)\r\n            {\r\n                min = datum;\r\n            }\r\n            if (datum > max)\r\n            {\r\n                max = datum;\r\n            }\r\n        }\r\n        context.fillRect(i, (1 + min) * amp, 1, Math.max(1, (max - min) * amp));\r\n    }\r\n\r\n    return textureSource;\r\n}\r\n\r\nexport { render };\r\nexport type { RenderOptions };\r\n\r\n"],"names":[],"mappings":";;;AA8BA,SAAS,MAAA,CAAO,OAAc,OAC9B,EAAA;AACI,EAAM,MAAA,MAAA,GAA4B,QAAS,CAAA,aAAA,CAAc,QAAQ,CAAA,CAAA;AAEjE,EAAU,OAAA,GAAA;AAAA,IACN,KAAO,EAAA,GAAA;AAAA,IACP,MAAQ,EAAA,GAAA;AAAA,IACR,IAAM,EAAA,OAAA;AAAA,IAAS,GAAI,WAAW,EAAC;AAAA,GACnC,CAAA;AAEA,EAAA,MAAA,CAAO,QAAQ,OAAQ,CAAA,KAAA,CAAA;AACvB,EAAA,MAAA,CAAO,SAAS,OAAQ,CAAA,MAAA,CAAA;AAExB,EAAM,MAAA,aAAA,GAAgB,IAAI,YAAa,CAAA;AAAA,IACnC,QAAU,EAAA,MAAA;AAAA,GACb,CAAA,CAAA;AAED,EAAI,IAAA,EAAE,KAAM,CAAA,KAAA,YAAiB,aAC7B,CAAA,EAAA;AACI,IAAO,OAAA,aAAA,CAAA;AAAA,GACX;AAEA,EAAA,MAAM,QAAuB,KAAM,CAAA,KAAA,CAAA;AAGnC,EAAA,OAAA,CAAQ,MAAO,CAAA,CAAC,CAAC,KAAA,CAAM,QAAQ,6BAA6B,CAAA,CAAA;AAE5D,EAAM,MAAA,OAAA,GAAoC,MAAO,CAAA,UAAA,CAAW,IAAI,CAAA,CAAA;AAEhE,EAAA,OAAA,CAAQ,YAAY,OAAQ,CAAA,IAAA,CAAA;AAC5B,EAAA,MAAM,IAAqB,GAAA,KAAA,CAAM,MAAO,CAAA,cAAA,CAAe,CAAC,CAAA,CAAA;AACxD,EAAA,MAAM,OAAe,IAAK,CAAA,IAAA,CAAK,IAAK,CAAA,MAAA,GAAS,QAAQ,KAAK,CAAA,CAAA;AAC1D,EAAM,MAAA,GAAA,GAAc,QAAQ,MAAS,GAAA,CAAA,CAAA;AAErC,EAAA,KAAA,IAAS,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,OAAA,CAAQ,OAAO,CACnC,EAAA,EAAA;AACI,IAAA,IAAI,GAAM,GAAA,CAAA,CAAA;AACV,IAAA,IAAI,GAAM,GAAA,CAAA,CAAA,CAAA;AAEV,IAAA,KAAA,IAAS,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,IAAA,EAAM,CAC1B,EAAA,EAAA;AACI,MAAA,MAAM,KAAgB,GAAA,IAAA,CAAM,CAAI,GAAA,IAAA,GAAQ,CAAC,CAAA,CAAA;AAEzC,MAAA,IAAI,QAAQ,GACZ,EAAA;AACI,QAAM,GAAA,GAAA,KAAA,CAAA;AAAA,OACV;AACA,MAAA,IAAI,QAAQ,GACZ,EAAA;AACI,QAAM,GAAA,GAAA,KAAA,CAAA;AAAA,OACV;AAAA,KACJ;AACA,IAAA,OAAA,CAAQ,QAAS,CAAA,CAAA,EAAA,CAAI,CAAI,GAAA,GAAA,IAAO,GAAK,EAAA,CAAA,EAAG,IAAK,CAAA,GAAA,CAAI,CAAI,EAAA,CAAA,GAAA,GAAM,GAAO,IAAA,GAAG,CAAC,CAAA,CAAA;AAAA,GAC1E;AAEA,EAAO,OAAA,aAAA,CAAA;AACX;;;;"}